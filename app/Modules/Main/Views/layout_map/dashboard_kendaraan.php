<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title><?= $title ?></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="<?=getenv('prop.appdesc')?>" name="description" />
    <meta content="<?=getenv('prop.appauthor')?>" name="author" />
    <link rel="shortcut icon" href="<?=base_url(getenv('prop.favicon'))?>">

    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet.MarkerCluster -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css' />
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css' />
    
    <link rel="stylesheet" href="<?= base_url('assets/hud') ?>/global.css" />
    <link rel="stylesheet" href="<?= base_url('assets/hud') ?>/index.css" />
    <link rel="stylesheet" href="<?= base_url('assets/hud') ?>/preloader.css" />
    <!-- <link rel="stylesheet" href="<?= base_url('assets/hud') ?>/slider.css" /> -->
    
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            z-index: 0;
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="loading">
        <div class="svg-frame">
          <svg style="--i:0;--j:0;">
            <g id="out1">
              <path d="M72 172C72 116.772 116.772 72 172 72C227.228 72 272 116.772 272 172C272 227.228 227.228 272 172 272C116.772 272 72 227.228 72 172ZM197.322 172C197.322 158.015 185.985 146.678 172 146.678C158.015 146.678 146.678 158.015 146.678 172C146.678 185.985 158.015 197.322 172 197.322C185.985 197.322 197.322 185.985 197.322 172Z" />
              <path d="M72 172C72 116.772 116.772 72 172 72C227.228 72 272 116.772 272 172C272 227.228 227.228 272 172 272C116.772 272 72 227.228 72 172ZM197.322 172C197.322 158.015 185.985 146.678 172 146.678C158.015 146.678 146.678 158.015 146.678 172C146.678 185.985 158.015 197.322 172 197.322C185.985 197.322 197.322 185.985 197.322 172Z" stroke="#224ddd" stroke-width="2" stroke-miterlimit="16" mask="url(#path-1-inside-1_111_3212)" />
            </g>
          </svg>
        
          <svg style="--i:1;--j:1;">
            <g id="out2">
              <mask id="path-2-inside-2_111_3212" fill="white">
                <path d="M102.892 127.966C93.3733 142.905 88.9517 160.527 90.2897 178.19L94.3752 177.88C93.1041 161.1 97.3046 144.36 106.347 130.168L102.892 127.966Z" />
                <path d="M93.3401 194.968C98.3049 211.971 108.646 226.908 122.814 237.541L125.273 234.264C111.814 224.163 101.99 209.973 97.2731 193.819L93.3401 194.968Z" />
                <path d="M152.707 92.3592C140.33 95.3575 128.822 101.199 119.097 109.421L121.742 112.55C130.981 104.739 141.914 99.1897 153.672 96.3413L152.707 92.3592Z" />
                <path d="M253.294 161.699C255.099 175.937 253.132 190.4 247.59 203.639L243.811 202.057C249.075 189.48 250.944 175.74 249.23 162.214L253.294 161.699Z" />
                <path d="M172 90.0557C184.677 90.0557 197.18 92.9967 208.528 98.6474C219.875 104.298 229.757 112.505 237.396 122.621L234.126 125.09C226.869 115.479 217.481 107.683 206.701 102.315C195.921 96.9469 184.043 94.1529 172 94.1529V90.0557Z" />
                <path d="M244.195 133.235C246.991 138.442 249.216 143.937 250.83 149.623L246.888 150.742C245.355 145.34 243.242 140.12 240.586 135.174L244.195 133.235Z" />
                <path d="M234.238 225.304C223.932 237.338 210.358 246.126 195.159 250.604C179.961 255.082 163.79 255.058 148.606 250.534L149.775 246.607C164.201 250.905 179.563 250.928 194.001 246.674C208.44 242.42 221.335 234.071 231.126 222.639L234.238 225.304Z" />
              </mask>
              <path d="M102.892 127.966L105.579 123.75L101.362 121.063L98.6752 125.28L102.892 127.966ZM90.2897 178.19L85.304 178.567L85.6817 183.553L90.6674 183.175L90.2897 178.19ZM94.3752 177.88L94.7529 182.866L99.7386 182.488L99.3609 177.503L94.3752 177.88ZM106.347 130.168L110.564 132.855L113.251 128.638L109.034 125.951L106.347 130.168ZM93.3401 194.968L91.9387 190.168L87.1391 191.569L88.5405 196.369L93.3401 194.968ZM122.814 237.541L119.813 241.54L123.812 244.541L126.813 240.542L122.814 237.541ZM125.273 234.264L129.272 237.265L132.273 233.266L128.274 230.265L125.273 234.264ZM97.2731 193.819L102.073 192.418L100.671 187.618L95.8717 189.02L97.2731 193.819ZM152.707 92.3592L157.567 91.182L156.389 86.3226L151.53 87.4998L152.707 92.3592ZM119.097 109.421L115.869 105.603L112.05 108.831L115.278 112.649L119.097 109.421ZM121.742 112.55L117.924 115.778L121.152 119.596L124.97 116.368L121.742 112.55ZM153.672 96.3413L154.849 101.201L159.708 100.023L158.531 95.1641L153.672 96.3413ZM253.294 161.699L258.255 161.07L257.626 156.11L252.666 156.738L253.294 161.699ZM247.59 203.639L245.66 208.251L250.272 210.182L252.203 205.569L247.59 203.639ZM243.811 202.057L239.198 200.126L237.268 204.739L241.88 206.669L243.811 202.057ZM249.23 162.214L248.601 157.253L243.641 157.882L244.269 162.842L249.23 162.214ZM172 90.0557V85.0557H167V90.0557H172ZM208.528 98.6474L206.299 103.123L206.299 103.123L208.528 98.6474ZM237.396 122.621L240.409 126.611L244.399 123.598L241.386 119.608L237.396 122.621ZM234.126 125.09L230.136 128.103L233.149 132.093L237.139 129.08L234.126 125.09ZM206.701 102.315L204.473 106.791L204.473 106.791L206.701 102.315ZM172 94.1529H167V99.1529H172V94.1529ZM244.195 133.235L248.601 130.87L246.235 126.465L241.83 128.83L244.195 133.235ZM250.83 149.623L252.195 154.433L257.005 153.067L255.64 148.257L250.83 149.623ZM246.888 150.742L242.078 152.107L243.444 156.917L248.254 155.552L246.888 150.742ZM240.586 135.174L238.22 130.768L233.815 133.134L236.181 137.539L240.586 135.174ZM234.238 225.304L238.036 228.556L241.288 224.759L237.491 221.506L234.238 225.304ZM195.159 250.604L196.572 255.4L196.572 255.4L195.159 250.604ZM148.606 250.534L143.814 249.107L142.386 253.899L147.178 255.326L148.606 250.534ZM149.775 246.607L151.203 241.816L146.411 240.388L144.983 245.18L149.775 246.607ZM194.001 246.674L195.415 251.47L195.415 251.47L194.001 246.674ZM231.126 222.639L234.379 218.841L230.581 215.589L227.329 219.386L231.126 222.639ZM98.6752 125.28C88.5757 141.13 83.8844 159.826 85.304 178.567L95.2754 177.812C94.0191 161.227 98.1709 144.681 107.109 130.653L98.6752 125.28ZM90.6674 183.175L94.7529 182.866L93.9976 172.895L89.912 173.204L90.6674 183.175ZM99.3609 177.503C98.1715 161.8 102.102 146.135 110.564 132.855L102.131 127.481C92.5071 142.585 88.0368 160.4 89.3895 178.258L99.3609 177.503ZM109.034 125.951L105.579 123.75L100.205 132.183L103.661 134.385L109.034 125.951ZM88.5405 196.369C93.8083 214.41 104.78 230.259 119.813 241.54L125.815 233.542C112.512 223.558 102.802 209.532 98.1397 193.566L88.5405 196.369ZM126.813 240.542L129.272 237.265L121.274 231.263L118.815 234.54L126.813 240.542ZM128.274 230.265C115.679 220.813 106.486 207.534 102.073 192.418L92.4735 195.221C97.493 212.412 107.948 227.513 122.272 238.263L128.274 230.265ZM95.8717 189.02L91.9387 190.168L94.7415 199.767L98.6745 198.619L95.8717 189.02ZM151.53 87.4998C138.398 90.681 126.188 96.8793 115.869 105.603L122.325 113.239C131.457 105.519 142.262 100.034 153.884 97.2187L151.53 87.4998ZM115.278 112.649L117.924 115.778L125.56 109.322L122.915 106.193L115.278 112.649ZM124.97 116.368C133.616 109.059 143.846 103.866 154.849 101.201L152.495 91.4818C139.981 94.5132 128.347 100.419 118.514 108.732L124.97 116.368ZM158.531 95.1641L157.567 91.182L147.848 93.5364L148.812 97.5185L158.531 95.1641ZM248.334 162.327C250.028 175.697 248.181 189.277 242.978 201.708L252.203 205.569C258.082 191.522 260.169 176.177 258.255 161.07L248.334 162.327ZM249.521 199.027L245.741 197.445L241.88 206.669L245.66 208.251L249.521 199.027ZM248.423 203.987C254.025 190.602 256.014 175.98 254.19 161.585L244.269 162.842C245.873 175.5 244.125 188.357 239.198 200.126L248.423 203.987ZM249.858 167.174L253.923 166.659L252.666 156.738L248.601 157.253L249.858 167.174ZM172 95.0557C183.903 95.0557 195.644 97.8172 206.299 103.123L210.757 94.1717C198.717 88.1761 185.45 85.0557 172 85.0557V95.0557ZM206.299 103.123C216.954 108.429 226.233 116.135 233.406 125.634L241.386 119.608C233.281 108.874 222.796 100.167 210.757 94.1717L206.299 103.123ZM234.383 118.631L231.113 121.1L237.139 129.08L240.409 126.611L234.383 118.631ZM238.116 122.077C230.393 111.849 220.403 103.552 208.93 97.8393L204.473 106.791C214.56 111.814 223.345 119.11 230.136 128.103L238.116 122.077ZM208.93 97.8393C197.458 92.1263 184.816 89.1529 172 89.1529V99.1529C183.269 99.1529 194.385 101.767 204.473 106.791L208.93 97.8393ZM177 94.1529V90.0557H167V94.1529H177ZM239.79 135.601C242.416 140.49 244.504 145.649 246.02 150.988L255.64 148.257C253.927 142.225 251.567 136.395 248.601 130.87L239.79 135.601ZM249.464 144.813L245.523 145.932L248.254 155.552L252.195 154.433L249.464 144.813ZM251.698 149.376C250.067 143.628 247.818 138.073 244.991 132.808L236.181 137.539C238.666 142.168 240.644 147.052 242.078 152.107L251.698 149.376ZM242.951 139.579L246.561 137.64L241.83 128.83L238.22 130.768L242.951 139.579ZM230.441 222.051C220.763 233.351 208.017 241.603 193.746 245.808L196.572 255.4C212.698 250.649 227.101 241.325 238.036 228.556L230.441 222.051ZM193.746 245.808C179.475 250.012 164.291 249.99 150.033 245.742L147.178 255.326C163.289 260.125 180.447 260.151 196.572 255.4L193.746 245.808ZM153.397 251.962L154.567 248.035L144.983 245.18L143.814 249.107L153.397 251.962ZM148.348 251.399C163.7 255.973 180.049 255.997 195.415 251.47L192.588 241.877C179.077 245.858 164.702 245.837 151.203 241.816L148.348 251.399ZM195.415 251.47C210.78 246.942 224.504 238.058 234.924 225.891L227.329 219.386C218.167 230.084 206.099 237.897 192.588 241.877L195.415 251.47ZM227.874 226.436L230.986 229.101L237.491 221.506L234.379 218.841L227.874 226.436Z" fill="#224ddd" mask="url(#path-2-inside-2_111_3212)" />
            </g>
          </svg>
        
          <svg style="--i:0;--j:2;">
            <g id="inner3">
              <path d="M195.136 135.689C188.115 131.215 179.948 128.873 171.624 128.946C163.299 129.019 155.174 131.503 148.232 136.099L148.42 136.382C155.307 131.823 163.368 129.358 171.627 129.286C179.886 129.213 187.988 131.537 194.954 135.975L195.136 135.689Z" />
              <path d="M195.136 208.311C188.115 212.784 179.948 215.127 171.624 215.054C163.299 214.981 155.174 212.496 148.232 207.901L148.42 207.618C155.307 212.177 163.368 214.642 171.627 214.714C179.886 214.786 187.988 212.463 194.954 208.025L195.136 208.311Z" />
              <path d="M195.136 135.689L195.474 135.904L195.689 135.566L195.351 135.352L195.136 135.689ZM171.624 128.946L171.627 129.346L171.624 128.946ZM148.232 136.099L148.011 135.765L147.678 135.986L147.899 136.32L148.232 136.099ZM148.42 136.382L148.086 136.603L148.307 136.936L148.641 136.716L148.42 136.382ZM171.627 129.286L171.63 129.686L171.627 129.286ZM194.954 135.975L194.739 136.313L195.076 136.528L195.291 136.19L194.954 135.975ZM195.136 208.311L195.351 208.648L195.689 208.433L195.474 208.096L195.136 208.311ZM171.624 215.054L171.627 214.654L171.624 215.054ZM148.232 207.901L147.899 207.68L147.678 208.014L148.011 208.234L148.232 207.901ZM148.42 207.618L148.641 207.284L148.307 207.063L148.086 207.397L148.42 207.618ZM171.627 214.714L171.63 214.314L171.627 214.714ZM194.954 208.025L195.291 207.81L195.076 207.472L194.739 207.687L194.954 208.025ZM195.351 135.352C188.265 130.836 180.022 128.473 171.62 128.546L171.627 129.346C179.874 129.274 187.966 131.594 194.921 136.026L195.351 135.352ZM171.62 128.546C163.218 128.619 155.018 131.127 148.011 135.765L148.453 136.432C155.33 131.88 163.38 129.418 171.627 129.346L171.62 128.546ZM147.899 136.32L148.086 136.603L148.753 136.161L148.566 135.878L147.899 136.32ZM148.641 136.716C155.463 132.199 163.448 129.757 171.63 129.686L171.623 128.886C163.287 128.958 155.15 131.447 148.199 136.049L148.641 136.716ZM171.63 129.686C179.812 129.614 187.839 131.916 194.739 136.313L195.169 135.638C188.138 131.158 179.959 128.813 171.623 128.886L171.63 129.686ZM195.291 136.19L195.474 135.904L194.799 135.474L194.617 135.76L195.291 136.19ZM194.921 207.974C187.966 212.406 179.874 214.726 171.627 214.654L171.62 215.454C180.022 215.527 188.265 213.163 195.351 208.648L194.921 207.974ZM171.627 214.654C163.38 214.582 155.33 212.12 148.453 207.567L148.011 208.234C155.018 212.873 163.218 215.38 171.62 215.454L171.627 214.654ZM148.566 208.122L148.753 207.838L148.086 207.397L147.899 207.68L148.566 208.122ZM148.199 207.951C155.15 212.553 163.287 215.041 171.623 215.114L171.63 214.314C163.448 214.243 155.463 211.801 148.641 207.284L148.199 207.951ZM171.623 215.114C179.959 215.187 188.138 212.842 195.169 208.362L194.739 207.687C187.839 212.084 179.812 214.386 171.63 214.314L171.623 215.114ZM194.617 208.239L194.799 208.526L195.474 208.096L195.291 207.81L194.617 208.239Z" fill="#224ddd" mask="url(#path-5-inside-3_111_3212)" />
            </g>
            <path id="out3" d="M240.944 172C240.944 187.951 235.414 203.408 225.295 215.738C215.176 228.068 201.095 236.508 185.45 239.62C169.806 242.732 153.567 240.323 139.5 232.804C125.433 225.285 114.408 213.12 108.304 198.384C102.2 183.648 101.394 167.25 106.024 151.987C110.654 136.723 120.434 123.537 133.696 114.675C146.959 105.813 162.884 101.824 178.758 103.388C194.632 104.951 209.472 111.97 220.751 123.249" stroke="#224ddd" />
          </svg>
        
          <svg style="--i:1;--j:3;">
            <g id="inner1">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M145.949 124.51L148.554 129.259C156.575 124.859 165.672 122.804 174.806 123.331C183.94 123.858 192.741 126.944 200.203 132.236C207.665 137.529 213.488 144.815 217.004 153.261C220.521 161.707 221.59 170.972 220.09 179.997L224.108 180.665L224.102 180.699L229.537 181.607C230.521 175.715 230.594 169.708 229.753 163.795L225.628 164.381C224.987 159.867 223.775 155.429 222.005 151.179C218.097 141.795 211.628 133.699 203.337 127.818C195.045 121.937 185.266 118.508 175.118 117.923C165.302 117.357 155.525 119.474 146.83 124.037C146.535 124.192 146.241 124.349 145.949 124.51ZM224.638 164.522C224.009 160.091 222.819 155.735 221.082 151.563C217.246 142.352 210.897 134.406 202.758 128.634C194.62 122.862 185.021 119.496 175.06 118.922C165.432 118.367 155.841 120.441 147.311 124.914L148.954 127.91C156.922 123.745 165.876 121.814 174.864 122.333C184.185 122.87 193.166 126.019 200.782 131.421C208.397 136.822 214.339 144.257 217.928 152.877C221.388 161.188 222.526 170.276 221.23 179.173L224.262 179.677C224.998 174.671 225.35 169.535 224.638 164.522Z" fill="#224ddd" />
              <path fill-rule="evenodd" clip-rule="evenodd" d="M139.91 220.713C134.922 217.428 130.469 213.395 126.705 208.758L130.983 205.286L130.985 205.288L134.148 202.721C141.342 211.584 151.417 217.642 162.619 219.839C173.821 222.036 185.438 220.232 195.446 214.742L198.051 219.491C197.759 219.651 197.465 219.809 197.17 219.963C186.252 225.693 173.696 227.531 161.577 225.154C154.613 223.789 148.041 221.08 142.202 217.234L139.91 220.713ZM142.752 216.399C148.483 220.174 154.934 222.833 161.769 224.173C173.658 226.504 185.977 224.704 196.689 219.087L195.046 216.09C185.035 221.323 173.531 222.998 162.427 220.82C151.323 218.643 141.303 212.747 134.01 204.122L131.182 206.5C134.451 210.376 138.515 213.607 142.752 216.399Z" fill="#224ddd" />
            </g>
          </svg>
        
          <svg style="--i:2;--j:4;">
            <path id="center1" d="M180.956 186.056C183.849 184.212 186.103 181.521 187.41 178.349C188.717 175.177 189.013 171.679 188.258 168.332C187.503 164.986 185.734 161.954 183.192 159.65C180.649 157.346 177.458 155.883 174.054 155.46C170.649 155.038 167.197 155.676 164.169 157.288C161.14 158.9 158.683 161.407 157.133 164.468C155.582 167.528 155.014 170.992 155.505 174.388C155.997 177.783 157.524 180.944 159.879 183.439L161.129 182.259C159.018 180.021 157.648 177.186 157.207 174.141C156.766 171.096 157.276 167.989 158.667 165.245C160.057 162.5 162.261 160.252 164.977 158.806C167.693 157.36 170.788 156.788 173.842 157.167C176.895 157.546 179.757 158.858 182.037 160.924C184.317 162.99 185.904 165.709 186.581 168.711C187.258 171.712 186.992 174.849 185.82 177.694C184.648 180.539 182.627 182.952 180.032 184.606L180.956 186.056Z" fill="#224ddd" />
            <path id="center" d="M172 166.445C175.068 166.445 177.556 168.932 177.556 172C177.556 175.068 175.068 177.556 172 177.556C168.932 177.556 166.444 175.068 166.444 172C166.444 168.932 168.932 166.445 172 166.445ZM172 177.021C174.773 177.021 177.021 174.773 177.021 172C177.021 169.227 174.773 166.979 172 166.979C169.227 166.979 166.979 169.227 166.979 172C166.979 174.773 169.227 177.021 172 177.021Z" fill="#224ddd" />
          </svg>
        
        </div>
    </div>
    <main class="dashboard" id="dashboard">
        <div class="contact-details__map-box">
            <div id="map"></div>
        </div>
        <!-- <header class="navbar-top-center" id="head">
            <div class="title-head">
                <div class="head-dashboard">
                    <div class="date-and-time">
                        <div class="date">
                            <i class="text-black fa-solid fa-calendar-day"></i>
                            <div class="date text-black">Sabtu, 01 juni 2024</div>
                        </div>
                        <div class="date">
                            <i class="text-black fa-solid fa-clock"></i>
                            <div class="date-time text-black">15:00:12</div>
                        </div>
                    </div>
                    <div class="text-dashboard">
                        <div class="text-dashboard-child">
                            <svg width="555" height="43" viewBox="0 0 552 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M101.94 43L0 0H550L448.06 43H101.94Z" fill="url(#paint0_linear_1_821)"/>
                                <defs>
                                <linearGradient id="paint0_linear_1_821" x1="275" y1="43.5" x2="274.794" y2="-47.5022" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#224ddd"/>
                                    <stop offset="0.737698" stop-color="#224ddd" stop-opacity="0"/>
                                </linearGradient>
                                </defs>
                            </svg>
                        </div>
                        <div class="dashboard1">DASHBOARD</div>
                        <div class="spread-icon">
                            <svg width="1435" height="47" viewBox="0 0 1435 47" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0.75 2H446.75L545.25 45H894.25L992.75 3H1439.25" stroke="#224ddd" stroke-width="3"/>
                            </svg>
                        </div>
                    </div>
                    <div class="head">
                        <i class="text-black fa-solid fa-house"></i>
                        <div class="home text-black">Home</div>
                        <div class="home text-black">/</div>
                        <div class="home text-black">Dashboard</div>
                    </div>
                </div>
            </div>
        </header> -->
    </main>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://gps.brtnusantara.com/dev/assets/gps/plugins/custom/Leaflet.encoded/Polyline.encoded.js"></script>
    <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
    <script src="<?= base_url('assets/js/leaflet.rotatedMarker.js') ?>"></script>
    <script src="<?= base_url('assets/hud/togeojson.js') ?>"></script>

    <script>
        let urlApi = `<?= base_url('api'); ?>`;
        let busMarker = {};
        let arrRoutes = {};
        let svgImage = {};
        let map;
        let pin = `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="516" height="760">
            <path d="M0 0 C1.03125 0.721875 2.0625 1.44375 3.125 2.1875 C11.81371417 9.76349055 15.08322012 21.62468082 15.8828125 32.70703125 C16.13532837 39.80272722 16.07028433 46.90128277 16 54 C16.93070312 54.12246094 17.86140625 54.24492188 18.8203125 54.37109375 C23.05223062 55.20811932 24.48355549 56.52138554 27 60 C27.70969896 62.83307248 27.70969896 65.16692752 27 68 C24.48355549 71.47861446 23.05223062 72.79188068 18.8203125 73.62890625 C17.88960937 73.75136719 16.95890625 73.87382813 16 74 C15.99576806 74.95268642 15.99153612 75.90537285 15.98717594 76.88692856 C15.88384828 100.09917013 15.77508301 123.31138141 15.66066074 146.52357101 C15.60545143 157.74893942 15.55199009 168.97431101 15.50268555 180.19970703 C15.45969264 189.98708208 15.41337744 199.7744349 15.36312145 209.56177545 C15.3366417 214.7410436 15.31179258 219.92030769 15.29092598 225.09960175 C15.27120438 229.98164036 15.24701653 234.86363713 15.21950912 239.74563789 C15.2102202 241.53052821 15.20251645 243.31542764 15.19658089 245.10033226 C15.08402841 277.95442709 15.08402841 277.95442709 8.203125 286.13671875 C-1.79488577 295.37906592 -13.11778569 295.15694873 -25.9765625 295.203125 C-27.2194101 295.20882507 -28.46225769 295.21452515 -29.74276733 295.22039795 C-32.36675168 295.22981655 -34.99074769 295.2363694 -37.61474609 295.24023438 C-41.59098391 295.24677026 -45.56685172 295.28096307 -49.54296875 295.3125 C-52.10416363 295.31903351 -54.66536217 295.32428261 -57.2265625 295.328125 C-58.39788727 295.3404718 -59.56921204 295.3528186 -60.77603149 295.36553955 C-70.88016685 295.3388069 -81.83764412 294.89019102 -90.125 288.5625 C-96.98719868 281.47071103 -98.16410408 273.17936233 -98.57397461 263.62231445 C-98.61353995 262.73622403 -98.6531053 261.85013361 -98.69386959 260.93719196 C-99.313493 245.01360651 -99.2345165 229.06240389 -99.30332303 213.12927794 C-99.32545926 208.22462141 -99.35271037 203.3199931 -99.37937927 198.4153595 C-99.42893807 189.16188218 -99.47401061 179.90838889 -99.51740164 170.65488082 C-99.56709237 160.10560365 -99.62189055 149.55635484 -99.67708123 139.00710523 C-99.7903348 117.33809668 -99.89729311 95.66906094 -100 74 C-101.65708984 73.57267578 -101.65708984 73.57267578 -103.34765625 73.13671875 C-107.59058779 71.81619139 -108.85837294 70.85492871 -111 67 C-111.58827012 62.88210918 -111.4635928 60.80237215 -109.375 57.1875 C-106.67884508 54.70419942 -104.46806123 54.04991991 -101 53 C-100.94392578 51.1128125 -100.94392578 51.1128125 -100.88671875 49.1875 C-99.63126633 13.96220265 -99.63126633 13.96220265 -86.8125 1.625 C-65.12850409 -16.07695994 -22.43971004 -16.37492354 0 0 Z M-88 17 C-91.04641536 20.50799344 -91.22372929 23.17543931 -91.1628418 27.75292969 C-90.88322381 31.61140631 -89.93196445 35.22684643 -88.875 38.9375 C-88.65271729 39.72584229 -88.43043457 40.51418457 -88.20141602 41.32641602 C-85.90616607 49.00982279 -82.82359604 55.43763462 -76 60 C-72.79062745 61.06979085 -70.45380667 61.13967094 -67.07910156 61.16113281 C-65.86063538 61.17074036 -64.64216919 61.1803479 -63.38677979 61.19024658 C-62.06804871 61.19449646 -60.74931763 61.19874634 -59.390625 61.203125 C-58.02162678 61.20888039 -56.65262857 61.21463807 -55.28363037 61.22039795 C-52.41206488 61.23090038 -49.54052731 61.23674751 -46.66894531 61.24023438 C-43.00275732 61.24570751 -39.33694289 61.26971293 -35.67087173 61.29820633 C-32.84144034 61.31690344 -30.01209749 61.32204212 -27.18260956 61.32357025 C-25.17803132 61.32804156 -23.17350063 61.34665625 -21.16900635 61.36553955 C-10.72000712 61.46939038 -10.72000712 61.46939038 -2.12475586 56.1315918 C1.60616497 50.26176292 3.7299622 44.53736066 5.4375 37.8125 C5.70498047 36.85408203 5.97246094 35.89566406 6.24804688 34.90820312 C7.75857889 29.20131063 8.86292544 24.53387001 5.9765625 19.05859375 C-3.16694587 8.09166897 -20.44890788 5.38439448 -34 4 C-52.02320307 3.00614363 -73.67244579 4.96611127 -88 17 Z M-92 56 C-93.53230794 62.61715659 -94.2992519 68.84300574 -94.265625 75.62890625 C-94.26753845 76.50344955 -94.2694519 77.37799286 -94.27142334 78.27903748 C-94.27277318 80.11172781 -94.26916156 81.94442811 -94.26074219 83.77709961 C-94.25001233 86.55930307 -94.26068531 89.34086291 -94.2734375 92.12304688 C-94.27211594 93.91666807 -94.26955363 95.71028887 -94.265625 97.50390625 C-94.26967346 98.32290909 -94.27372192 99.14191193 -94.27789307 99.98573303 C-94.23338626 105.54805254 -93.40851427 110.62169416 -92 116 C-90.68 116.33 -89.36 116.66 -88 117 C-82.34587267 110.56599303 -80.53351334 104.9102773 -80.53125 96.57421875 C-80.52363647 95.78658646 -80.51602295 94.99895416 -80.50817871 94.18745422 C-80.49742991 92.52937977 -80.49450325 90.8712379 -80.49902344 89.21313477 C-80.49999359 86.70406494 -80.4583628 84.19808085 -80.4140625 81.68945312 C-80.34895728 72.84493067 -80.5312022 65.42298995 -86 58 C-86.66 57.34 -87.32 56.68 -88 56 C-89.32 56 -90.64 56 -92 56 Z M4 56 C2.22262351 58.09996862 2.22262351 58.09996862 0.8125 60.8125 C0.30332031 61.70582031 -0.20585937 62.59914063 -0.73046875 63.51953125 C-3.94716966 69.80446995 -3.33560609 76.62260944 -3.4050293 83.52075195 C-3.42646292 85.11602622 -3.46038922 86.71118769 -3.50756836 88.3059082 C-3.79879649 98.2584483 -3.87483799 107.96133739 3 116 C5.6040841 116.87905575 5.6040841 116.87905575 8 117 C10.11725729 110.94100676 10.29160513 105.41247725 10.265625 99.02734375 C10.26753845 97.98606827 10.2694519 96.94479279 10.27142334 95.8719635 C10.27277947 93.67920692 10.26912312 91.48644216 10.26074219 89.29370117 C10.2500239 85.94496589 10.26066269 82.59676571 10.2734375 79.24804688 C10.27211602 77.11197799 10.26955385 74.97590943 10.265625 72.83984375 C10.26967346 71.84282944 10.27372192 70.84581512 10.27789307 69.81858826 C10.24425009 64.81322872 9.98537196 60.68888864 8 56 C6.68 56 5.36 56 4 56 Z M-60 104 C-60.43321985 106.48505243 -60.43321985 106.48505243 -60.328125 109.375 C-60.32296875 110.44234375 -60.3178125 111.5096875 -60.3125 112.609375 C-60.291875 113.72828125 -60.27125 114.8471875 -60.25 116 C-60.24484375 117.11890625 -60.2396875 118.2378125 -60.234375 119.390625 C-60.43210268 124.86709976 -60.43210268 124.86709976 -59 130 C-54.17619198 130.0246519 -49.35242033 130.04283693 -44.52856445 130.05493164 C-42.88630536 130.05997174 -41.24405077 130.06680378 -39.60180664 130.07543945 C-37.24624521 130.08751926 -34.89074291 130.09323139 -32.53515625 130.09765625 C-31.42733543 130.10539818 -31.42733543 130.10539818 -30.2971344 130.11329651 C-28.53101912 130.1134925 -26.76502854 130.06194719 -25 130 C-22.39904644 127.39904644 -23.76535464 120.06143851 -23.75 116.5625 C-23.729375 115.39138672 -23.70875 114.22027344 -23.6875 113.01367188 C-23.68234375 111.89669922 -23.6771875 110.77972656 -23.671875 109.62890625 C-23.6625293 108.59838135 -23.65318359 107.56785645 -23.64355469 106.50610352 C-23.76118164 105.67908936 -23.87880859 104.8520752 -24 104 C-27.6429048 101.5713968 -29.41303841 101.74238099 -33.75 101.734375 C-34.73178223 101.73150482 -34.73178223 101.73150482 -35.73339844 101.72857666 C-37.11523829 101.72721755 -38.49709103 101.73089487 -39.87890625 101.73925781 C-41.9924796 101.74996191 -44.10520305 101.73935399 -46.21875 101.7265625 C-47.56250187 101.72788414 -48.90625322 101.73044664 -50.25 101.734375 C-51.47203125 101.73663086 -52.6940625 101.73888672 -53.953125 101.74121094 C-57.17472243 101.76815909 -57.17472243 101.76815909 -60 104 Z M-92 126 C-93.55969767 132.70292026 -94.29867945 139.00822639 -94.265625 145.8828125 C-94.26753845 146.78192352 -94.2694519 147.68103455 -94.27142334 148.60739136 C-94.27277346 150.49135623 -94.26915989 152.37533079 -94.26074219 154.25927734 C-94.25000042 157.12488846 -94.26069064 159.98987642 -94.2734375 162.85546875 C-94.27211619 164.69791803 -94.26955438 166.54036693 -94.265625 168.3828125 C-94.26967346 169.2288504 -94.27372192 170.07488831 -94.27789307 170.94656372 C-94.23626151 176.28225315 -93.48411327 180.8704506 -92 186 C-90.68 186.33 -89.36 186.66 -88 187 C-87.0165504 185.56542672 -86.03839079 184.12722594 -85.0625 182.6875 C-84.24458984 181.48673828 -84.24458984 181.48673828 -83.41015625 180.26171875 C-79.63001961 174.19884031 -80.69882989 166.44078487 -80.64990234 159.51489258 C-80.63342052 157.80902388 -80.60623416 156.10322199 -80.56787109 154.39770508 C-80.14900818 140.43575873 -80.14900818 140.43575873 -86 128 C-86.66 127.34 -87.32 126.68 -88 126 C-89.32 126 -90.64 126 -92 126 Z M2.5859375 127.3203125 C2.18632812 127.91585937 1.78671875 128.51140625 1.375 129.125 C0.97023438 129.70507812 0.56546875 130.28515625 0.1484375 130.8828125 C-2.65353036 136.04834509 -3.33555345 141.02327926 -3.40625 146.8203125 C-3.41765015 147.5602243 -3.42905029 148.30013611 -3.4407959 149.06246948 C-3.45960763 150.62394578 -3.47272862 152.18549989 -3.48046875 153.74707031 C-3.49978213 156.09847387 -3.56184428 158.44629791 -3.625 160.796875 C-3.75505132 169.96816185 -3.26505188 178.64216662 3 186 C5.60383033 186.88005048 5.60383033 186.88005048 8 187 C10.46577484 181.25611586 10.28934509 175.78696643 10.265625 169.65234375 C10.26753845 168.56288956 10.2694519 167.47343536 10.27142334 166.35096741 C10.2727811 164.05388151 10.26911332 161.75678784 10.26074219 159.4597168 C10.25002677 155.94627655 10.26065694 152.4333464 10.2734375 148.91992188 C10.27211604 146.68489471 10.26955391 144.44986786 10.265625 142.21484375 C10.26967346 141.16578354 10.27372192 140.11672333 10.27789307 139.03587341 C10.27158875 138.05457962 10.26528442 137.07328583 10.25878906 136.06225586 C10.25719788 135.20321152 10.25560669 134.34416718 10.25396729 133.45909119 C9.96776953 130.6879218 9.13984751 128.52990071 8 126 C4.16484211 125.54502526 4.16484211 125.54502526 2.5859375 127.3203125 Z M-44.5625 192.4375 C-46.4487207 192.49647461 -46.4487207 192.49647461 -48.37304688 192.55664062 C-49.57123047 192.59853516 -50.76941406 192.64042969 -52.00390625 192.68359375 C-53.10549072 192.72025146 -54.2070752 192.75690918 -55.34204102 192.79467773 C-57.97416545 192.83000037 -57.97416545 192.83000037 -60 194 C-60 202.25 -60 210.5 -60 219 C-55.88197155 221.05901422 -54.10622901 221.25665229 -49.625 221.265625 C-48.39265625 221.26820313 -47.1603125 221.27078125 -45.890625 221.2734375 C-44.60671875 221.26570313 -43.3228125 221.25796875 -42 221.25 C-40.07414062 221.26160156 -40.07414062 221.26160156 -38.109375 221.2734375 C-36.26085937 221.26957031 -36.26085937 221.26957031 -34.375 221.265625 C-33.24835938 221.26336914 -32.12171875 221.26111328 -30.9609375 221.25878906 C-27.70054784 221.15663909 -27.70054784 221.15663909 -24 219 C-24 210.75 -24 202.5 -24 194 C-30.37541032 190.81229484 -37.5262218 192.19511921 -44.5625 192.4375 Z M-90 195 C-92.14646991 195.78616307 -92.14646991 195.78616307 -92.62347412 197.72363281 C-93.8710157 203.45934067 -94.29373904 208.88885136 -94.265625 214.75 C-94.26849518 216.09723145 -94.26849518 216.09723145 -94.27142334 217.47167969 C-94.27277522 219.35742475 -94.26914906 221.24317944 -94.26074219 223.12890625 C-94.25002842 225.99240298 -94.26067165 228.85527246 -94.2734375 231.71875 C-94.27211573 233.56250137 -94.26955297 235.40625235 -94.265625 237.25 C-94.26967346 238.09401367 -94.27372192 238.93802734 -94.27789307 239.80761719 C-94.23416233 245.43421199 -93.43235676 250.56051544 -92 256 C-90.68 256.33 -89.36 256.66 -88 257 C-87.0165504 255.56542672 -86.03839079 254.12722594 -85.0625 252.6875 C-84.24458984 251.48673828 -84.24458984 251.48673828 -83.41015625 250.26171875 C-79.58172715 244.12138509 -80.65964348 236.161208 -80.5949707 229.14257812 C-80.57349707 227.39497996 -80.53952184 225.6474862 -80.49243164 223.90039062 C-80.01998528 208.93820116 -80.01998528 208.93820116 -87 196 C-87.99 195.67 -88.98 195.34 -90 195 Z M1.9375 198 C-1.98215264 204.06913958 -3.46664623 209.84844219 -3.46875 217.0859375 C-3.47636353 217.82776276 -3.48397705 218.56958801 -3.49182129 219.33389282 C-3.5025489 220.8918321 -3.50550554 222.44984287 -3.50097656 224.0078125 C-3.50000486 226.3632263 -3.54169011 228.71536791 -3.5859375 231.0703125 C-3.65353962 239.7080824 -3.01315649 246.66315693 2 254 C2.66 254.99 3.32 255.98 4 257 C5.32 257 6.64 257 8 257 C10.11725729 250.94100676 10.29160513 245.41247725 10.265625 239.02734375 C10.26753845 237.98606827 10.2694519 236.94479279 10.27142334 235.8719635 C10.27277947 233.67920692 10.26912312 231.48644216 10.26074219 229.29370117 C10.2500239 225.94496589 10.26066269 222.59676571 10.2734375 219.24804688 C10.27211602 217.11197799 10.26955385 214.97590943 10.265625 212.83984375 C10.26967346 211.84282944 10.27372192 210.84581512 10.27789307 209.81858826 C10.24425009 204.81322872 9.98537196 200.68888864 8 196 C3.99977339 195.53590278 3.99977339 195.53590278 1.9375 198 Z M-85.64453125 260.7265625 C-88.5122767 265.38784774 -90.93748402 270.39616295 -90 276 C-84.68471229 282.84468654 -74.81794762 283.90165095 -66.67041016 284.98901367 C-45.19053507 287.43125856 -12.60501427 290.79045523 5.8125 276.875 C7.45979657 272.88680832 6.61170977 270.49887694 5.19921875 266.51171875 C3.15497483 262.23012644 0.31999944 258.15999972 -4 256 C-6.306383 255.89236848 -8.61594388 255.85106853 -10.92480469 255.83886719 C-11.63722321 255.83390228 -12.34964172 255.82893738 -13.08364868 255.82382202 C-15.44640055 255.80918834 -17.80908521 255.80239538 -20.171875 255.796875 C-21.81374107 255.79112323 -23.45560712 255.7853655 -25.09747314 255.77960205 C-28.54415195 255.76908774 -31.99080741 255.76324833 -35.4375 255.75976562 C-39.84701249 255.75428898 -44.25621492 255.73028071 -48.66563034 255.70179367 C-52.05947763 255.68313573 -55.45325084 255.67795995 -58.84714508 255.67642975 C-60.47219787 255.67340831 -62.09724952 255.66539696 -63.72225189 255.65224457 C-66.00094381 255.63512248 -68.27888641 255.6370793 -70.55761719 255.64355469 C-71.85286316 255.63990906 -73.14810913 255.63626343 -74.48260498 255.63250732 C-79.00242541 256.10473205 -82.47703775 257.40107051 -85.64453125 260.7265625 Z " transform="translate(151,38)"/>
            </svg>`;
        let i_ = 0;
        let numDeltas = 100;
        let delay = 1;
        let i = 0;
        let theBus_i = {};
        let theBus_deltaLat = {};
        let theBus_deltaLng = {};
        let theBusPos = {}; 
    

        document.addEventListener("DOMContentLoaded", function() {
            // Simulasi pemuatan konten
            setTimeout(loadingPreloader, 5000); // Ganti dengan waktu pemuatan konten yang sesungguhnya
        });

        $(document).ready(async function() {
            // Initialize map
            map = L.map('map').setView([-6.200000, 106.816666], 12); // Jakarta coordinates

            // Base layers
            const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            await loadBus();

            // const topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            //     attribution: '© OpenTopoMap'
            // });

            // Layer control
            // const baseLayers = {
            //     "OpenStreetMap": osm,
            //     "Topographic": topo
            // };
            
            // L.control.layers(baseLayers).addTo(map);

            // // Fitur dinamis: Tambah marker saat klik peta
            // map.on('click', function(e) {
            //     L.marker([e.latlng.lat, e.latlng.lng])
            //         .addTo(map)
            //         .bindPopup(`Lokasi: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`)
            //         .openPopup();
            // });
            
            // // Add marker on click
            // let markers = [];
            // $('#add-marker').click(function() {
            //     const center = map.getCenter();
            //     const marker = L.marker([center.lat, center.lng]).addTo(map)
            //         .bindPopup(`New Marker at:<br>${center.lat.toFixed(4)}, ${center.lng.toFixed(4)}`);
            //     markers.push(marker);
            // });
            
            // // Update coordinates display
            // map.on('mousemove', function(e) {
            //     $('#coordinates').html(
            //         `Lat: ${e.latlng.lat.toFixed(4)}<br>Lng: ${e.latlng.lng.toFixed(4)}`
            //     );
            // });
            
            // // Geolocation
            // $('#geolocate').click(function() {
            //     map.locate({setView: true, maxZoom: 16});
            // });
            
            // // Clear markers
            // $('#clear-markers').click(function() {
            //     markers.forEach(marker => map.removeLayer(marker));
            //     markers = [];
            // });
        });

        function svgStringToImageSrc (svgString) {
            return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString)
        }
    
        function angle(cx, cy, ex, ey) {
            let dy = ey - cy;
            let dx = ex - cx;
            let theta = Math.atan2(dy, dx); // range (-PI, PI]
            theta *= 180 / Math.PI; // rads to degs, range (-180, 180]
            //if (theta < 0) theta = 360 + theta; // range [0, 360)
            return theta;
        }
        

        let loadBus = async function() {
            let vehicles = await handleRequest("GET", `${urlApi}/vehicle/bus?limit=99999`);
            if(vehicles.status_code==200){
            $.each(vehicles.data,function(index,item){
                theBusPos[item.gps_sn] = [item.lat,item.lng];
                newMarker(item);
            })
            }
            // socket.on('new message jtm', function(vehicles){
            //     updateMarker(vehicles);
            // });
        }
        
        let updateMarker = function(item){
            if(typeof busMarker[item.gps_sn] == 'undefined'){
               newMarker(item);
            }else{
                busMarker[item.gps_sn].setLatLng([item.latitude, item.longitude])
                .setRotationAngle(item.angle)
                .setPopup(loadTooltip(item));
            }
        }
        
        let newMarker = function(item){
            busMarker[item.gps_sn] = L.marker([item.latitude, item.longitude], {
            icon: L.divIcon({
                html: loadSVG(item).outerHTML,
                className: 'custom-icon',
                iconSize: [30, 39]
            })
            }).addTo(map);
            busMarker[item.gps_sn].setRotationAngle(item.angle);
            busMarker[item.gps_sn].bindPopup(loadTooltip(item));
        }
        
        let loadTooltip = function(item){
           let setHTML_ = `
            <div class="popup-bus text-center mb-2" style="animation: back-animation 2s infinite;">
                <span>Bus</span>
                <div style="border: 1px solid #224ddd;" data-bs-toggle="modal" data-bs-target="#busModal"></div>
            </div>
            <div class="ms-2 me-auto">
                Bus : ${item.route_type} - ${item.nomor_kendaraan}<br/>
                Position : ${item.latitude}, ${item.longitude}<br/>
                Speed : ${item.speed} km/h<br/>
                Direction : ${item.angle}<br/>
                Status : ${item.signal == "1" ? 'Terkoneksi':'Tidak Terkoneksi'} <br/>
                Last update : ${item.date_tracker} <br/>
                Last Position : ${item.address}<br/>
            </div>
           `;
           return L.popup({ offset: [0, -15], className: 'pod-popup' }).setContent(setHTML_);
        }
        
        let loadSVG = function(item){
            svgImage[item.gps_sn] = new Image(30, 39);
              svgImage.onload = () => {
              map.addImage('svg', svgImage[item.gps_sn]);
            }
            const busColor = item.signal == "1" ? '#224ddd' : 'red';
            let newPath = $($(pin)[0].children[0])
            .attr('fill', busColor) //arrRoutes[item.kor].color
            .attr('stroke', busColor)
            .attr('stroke-width','5');
            
            let newSVG = `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="324" height="540">`+newPath[0].outerHTML+`</svg>`;
            
            svgImage[item.gps_sn].src = svgStringToImageSrc(newSVG);
            return svgImage[item.gps_sn]
        }
        
        async function handleRequest(method, url, data = null, isFile = false) {
            let settings = {
                "url": url,
                "method": method,
                "timeout": 0,
                "processData": !isFile,
                "contentType": isFile ? false : 'application/x-www-form-urlencoded; charset=UTF-8; application/json;',
                "data": isFile ? data : $.param(data)
            };

            try {
                let startTime = performance.now();
                let response = await $.ajax(settings);
                let endTime = performance.now();
                let timeCompleteAjax = endTime - startTime;

                setTimeout(loadingPreloader(), timeCompleteAjax);
                return response;
            } catch (error) {
                setTimeout(loadingPreloader(), timeCompleteAjax);
                console.error("Request failed", error);
                return false;
            }
        }

        function loadingPreloader() {
            const preloader = document.getElementById("loading");
            const svgFrame = document.querySelector(".svg-frame");
            preloader.style.display = "none";
            svgFrame.style.display = "block";
        }

    </script>
</body>
</html>